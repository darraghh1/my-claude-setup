<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 734" font-family="Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif">

  <!-- ══════════════════════════════════════════════════════════════════
       Implementation Pipeline — Hand-crafted SVG
       Layout: Planning (left) → Implementation Orchestrator (right)
       Canvas: 950×734, content starts at (30, 20)
       ══════════════════════════════════════════════════════════════════ -->

  <defs>
    <!-- Arrow markers: one per semantic color -->
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#6b7280"/>
    </marker>
    <marker id="arrow-pass" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#22c55e"/>
    </marker>
    <marker id="arrow-fail" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#ef4444"/>
    </marker>

    <!-- Subtle drop shadow for depth -->
    <filter id="shadow" x="-4%" y="-4%" width="108%" height="108%">
      <feDropShadow dx="0" dy="1" stdDeviation="2" flood-opacity="0.08"/>
    </filter>

    <!-- Vertical gradients for group backgrounds -->
    <linearGradient id="planGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#eff6ff"/>
      <stop offset="100%" stop-color="#dbeafe"/>
    </linearGradient>
    <linearGradient id="buildGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#faf5ff"/>
      <stop offset="100%" stop-color="#f3e8ff"/>
    </linearGradient>
    <linearGradient id="validateGrad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#f0fdf4"/>
      <stop offset="100%" stop-color="#dcfce7"/>
    </linearGradient>
  </defs>

  <style>
    .title { font-size: 11px; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }
    .node-text { font-size: 13px; font-weight: 500; }
    .node-sub { font-size: 11px; fill: #6b7280; }
    .label { font-size: 11px; font-weight: 600; }
    .label-pass { fill: #16a34a; }
    .label-fail { fill: #dc2626; }
    .label-fix { fill: #d97706; }
    .slash { font-size: 13px; font-weight: 700; font-family: 'JetBrains Mono', 'Fira Code', monospace; }
  </style>

  <!-- ═══ PLANNING PHASE ═══════════════════════════════════════════════
       User-driven: create → review → gate → audit
       Blue color scheme, gradient background
       Bounding box: (30, 20) → (290, 320)                              -->
  <g>
    <rect x="30" y="20" width="260" height="300" rx="12"
          fill="url(#planGrad)" stroke="#93c5fd" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="160" y="46" text-anchor="middle" class="title" fill="#1d4ed8">Planning</text>

    <!-- /create-plan action node -->
    <rect x="70" y="64" width="180" height="40" rx="8"
          fill="#fff" stroke="#3b82f6" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="160" y="88" text-anchor="middle" class="slash" fill="#2563eb">/create-plan</text>

    <!-- Arrow: /create-plan → /review-plan -->
    <line x1="160" y1="104" x2="160" y2="124" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- /review-plan action node -->
    <rect x="70" y="126" width="180" height="40" rx="8"
          fill="#fff" stroke="#3b82f6" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="160" y="150" text-anchor="middle" class="slash" fill="#2563eb">/review-plan</text>

    <!-- Arrow: /review-plan → Passes? diamond -->
    <line x1="160" y1="166" x2="160" y2="186" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- Decision: review passes? (center 160,213, half-w 55, half-h 25) -->
    <polygon points="160,188 215,213 160,238 105,213"
             fill="#fff" stroke="#3b82f6" stroke-width="1.5"/>
    <text x="160" y="216" text-anchor="middle" class="node-text" fill="#1e40af" font-size="11">Passes?</text>

    <!-- Yes branch: down to /audit-plan -->
    <line x1="160" y1="238" x2="160" y2="258" stroke="#22c55e" stroke-width="1.5" marker-end="url(#arrow-pass)"/>
    <text x="170" y="254" class="label label-pass">Yes</text>

    <!-- Fix loopback: diamond left → outside group → back up to /review-plan
         Routes at x=56, 26px outside group left edge (x=30) -->
    <line x1="105" y1="213" x2="56" y2="213" stroke="#ef4444" stroke-width="1.5"/>
    <line x1="56" y1="213" x2="56" y2="146" stroke="#ef4444" stroke-width="1.5"/>
    <line x1="56" y1="146" x2="68" y2="146" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrow-fail)"/>
    <text x="44" y="183" class="label label-fix" transform="rotate(-90 44 183)">Fix</text>

    <!-- /audit-plan with subtitle (taller node: 44px) -->
    <rect x="70" y="260" width="180" height="44" rx="8"
          fill="#fff" stroke="#3b82f6" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="160" y="278" text-anchor="middle" class="slash" fill="#2563eb" font-size="12">/audit-plan</text>
    <text x="160" y="293" text-anchor="middle" class="node-sub">for plans with 3+ phases</text>
  </g>

  <!-- ═══ Cross-group connector: Planning → Implementation ═════════════
       Multi-segment path: down from /audit-plan → under planning →
       up to implementation top → right into first node
       Routes through (160,340) → (315,340) → (315,83) → (398,83)      -->
  <path d="M 160 306 L 160 340 L 315 340 L 315 83 L 398 83"
        fill="none" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- ═══ IMPLEMENTATION PHASE ═════════════════════════════════════════
       /implement orchestrator loop with Builder + Validator subgroups
       Gray outer container, nested purple (builder) + green (validator)
       Bounding box: (342, 20) → (927, 714)                             -->
  <g>
    <!-- Outer container -->
    <rect x="342" y="20" width="585" height="694" rx="12"
          fill="#fafafa" stroke="#d1d5db" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="634" y="46" text-anchor="middle" class="title" fill="#374151">/implement — Orchestrator Loop</text>

    <!-- Find unblocked phases (two-line node: 200×38) -->
    <rect x="400" y="64" width="200" height="38" rx="8"
          fill="#fff" stroke="#6b7280" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="500" y="82" text-anchor="middle" class="node-text" fill="#374151">Find unblocked phases</text>
    <text x="500" y="95" text-anchor="middle" class="node-sub">from plan.md phase table</text>

    <!-- Arrow: Find unblocked → All done? -->
    <line x1="500" y1="102" x2="500" y2="118" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- All done? diamond (center 500,144, half-w 58, half-h 26) -->
    <polygon points="500,118 558,144 500,170 442,144"
             fill="#fff" stroke="#6b7280" stroke-width="1.5"/>
    <text x="500" y="148" text-anchor="middle" class="node-text" fill="#374151" font-size="10">All done?</text>

    <!-- Yes → right to "All done" terminal pill -->
    <line x1="558" y1="144" x2="614" y2="144" stroke="#22c55e" stroke-width="1.5" marker-end="url(#arrow-pass)"/>
    <text x="576" y="137" class="label label-pass" font-size="10">Yes</text>

    <!-- All done pill (terminal state) -->
    <rect x="616" y="128" width="140" height="32" rx="16"
          fill="#dcfce7" stroke="#16a34a" stroke-width="2" filter="url(#shadow)"/>
    <text x="686" y="146" text-anchor="middle" class="node-text" fill="#15803d" font-weight="700">All done</text>
    <text x="686" y="157" text-anchor="middle" class="node-sub" font-size="9">shutdown team</text>

    <!-- No → down to Phase gate (40px gap for label clearance) -->
    <line x1="500" y1="170" x2="500" y2="210" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>
    <text x="512" y="194" class="node-sub" font-size="10">No</text>

    <!-- Phase gate diamond (center 500,234, half-w 62, half-h 24) -->
    <polygon points="500,210 562,234 500,258 438,234"
             fill="#fff" stroke="#6b7280" stroke-width="1.5"/>
    <text x="500" y="238" text-anchor="middle" class="node-text" fill="#374151" font-size="11">Phase gate</text>

    <!-- Gate Checks annotation (positioned right of main flow) -->
    <rect x="700" y="210" width="175" height="72" rx="6"
          fill="#fefce8" stroke="#eab308" stroke-width="1" filter="url(#shadow)"/>
    <text x="788" y="228" text-anchor="middle" class="title" fill="#a16207" font-size="10">Gate Checks</text>
    <text x="788" y="243" text-anchor="middle" class="node-sub" font-size="10">Flow audit exists</text>
    <text x="788" y="256" text-anchor="middle" class="node-sub" font-size="10">No placeholder content</text>
    <text x="788" y="269" text-anchor="middle" class="node-sub" font-size="10">Phase review passes</text>

    <!-- Dashed connector: Phase gate → Gate Checks annotation -->
    <line x1="562" y1="234" x2="698" y2="234" stroke="#eab308" stroke-width="1" stroke-dasharray="4 3"/>

    <!-- Arrow: Phase gate → Builder subgroup (pass) -->
    <line x1="500" y1="258" x2="500" y2="276" stroke="#22c55e" stroke-width="1.5" marker-end="url(#arrow-pass)"/>

    <!-- ═══ BUILDER SUBGROUP ═══════════════════════════════════════════
         Purple dashed border, 3 inner nodes
         Ephemeral agent spawned per phase
         Bounding box: (388, 278) → (678, 472)                          -->
    <rect x="388" y="278" width="290" height="194" rx="10"
          fill="url(#buildGrad)" stroke="#a78bfa" stroke-width="1.5" stroke-dasharray="6 3"/>
    <text x="533" y="298" text-anchor="middle" class="title" fill="#7c3aed">Builder (ephemeral, per phase)</text>

    <!-- Builder node 1: Find reference + domain skill -->
    <rect x="412" y="310" width="242" height="34" rx="6"
          fill="#fff" stroke="#8b5cf6" stroke-width="1" filter="url(#shadow)"/>
    <text x="533" y="331" text-anchor="middle" class="node-text" fill="#5b21b6">Find reference + domain skill</text>

    <line x1="533" y1="344" x2="533" y2="358" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- Builder node 2: TDD first, then implement -->
    <rect x="412" y="360" width="242" height="34" rx="6"
          fill="#fff" stroke="#8b5cf6" stroke-width="1" filter="url(#shadow)"/>
    <text x="533" y="381" text-anchor="middle" class="node-text" fill="#5b21b6">TDD first, then implement</text>

    <line x1="533" y1="394" x2="533" y2="408" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- Builder node 3: tests + typecheck -->
    <rect x="412" y="410" width="242" height="34" rx="6"
          fill="#fff" stroke="#8b5cf6" stroke-width="1" filter="url(#shadow)"/>
    <text x="533" y="431" text-anchor="middle" class="node-text" fill="#5b21b6">tests + typecheck</text>

    <!-- Quality Hooks annotation (positioned right of builder) -->
    <rect x="700" y="330" width="175" height="74" rx="6"
          fill="#fefce8" stroke="#eab308" stroke-width="1" filter="url(#shadow)"/>
    <text x="788" y="350" text-anchor="middle" class="title" fill="#a16207" font-size="10">Quality Hooks</text>
    <text x="788" y="365" text-anchor="middle" class="node-sub" font-size="10">PostToolUse: TS checks</text>
    <text x="788" y="378" text-anchor="middle" class="node-sub" font-size="10">pnpm test + typecheck</text>
    <text x="788" y="391" text-anchor="middle" class="node-sub" font-size="10">Codebase-grounded review</text>

    <!-- Dashed connector: Builder → Quality Hooks annotation -->
    <line x1="654" y1="367" x2="698" y2="367" stroke="#eab308" stroke-width="1" stroke-dasharray="4 3"/>

    <!-- Arrow: Builder → Validator -->
    <line x1="533" y1="472" x2="533" y2="492" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- ═══ VALIDATOR SUBGROUP ═════════════════════════════════════════
         Green dashed border, 2 inner nodes
         Runs /code-review independently from builder
         Bounding box: (388, 494) → (678, 624)                          -->
    <rect x="388" y="494" width="290" height="130" rx="10"
          fill="url(#validateGrad)" stroke="#4ade80" stroke-width="1.5" stroke-dasharray="6 3"/>
    <text x="533" y="514" text-anchor="middle" class="title" fill="#15803d">Validator (ephemeral, per phase)</text>

    <!-- Validator node 1: /code-review + auto-fix -->
    <rect x="412" y="526" width="242" height="34" rx="6"
          fill="#fff" stroke="#22c55e" stroke-width="1" filter="url(#shadow)"/>
    <text x="533" y="547" text-anchor="middle" class="slash" fill="#15803d" font-size="12">/code-review + auto-fix</text>

    <line x1="533" y1="560" x2="533" y2="574" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- Validator node 2: tests + typecheck -->
    <rect x="412" y="576" width="242" height="34" rx="6"
          fill="#fff" stroke="#22c55e" stroke-width="1" filter="url(#shadow)"/>
    <text x="533" y="597" text-anchor="middle" class="node-text" fill="#166534">tests + typecheck</text>

    <!-- Arrow: Validator → Result diamond -->
    <line x1="533" y1="624" x2="533" y2="644" stroke="#6b7280" stroke-width="1.5" marker-end="url(#arrow)"/>

    <!-- ═══ Result diamond (center 533,669, half-w 60, half-h 25) ═════ -->
    <polygon points="533,644 593,669 533,694 473,669"
             fill="#fff" stroke="#6b7280" stroke-width="1.5"/>
    <text x="533" y="673" text-anchor="middle" class="node-text" fill="#374151" font-size="12">Result</text>

    <!-- PASS → right to Phase done box -->
    <line x1="593" y1="669" x2="658" y2="669" stroke="#22c55e" stroke-width="1.5" marker-end="url(#arrow-pass)"/>
    <text x="620" y="662" class="label label-pass">PASS</text>

    <!-- Phase done box -->
    <rect x="660" y="653" width="130" height="32" rx="8"
          fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5" filter="url(#shadow)"/>
    <text x="725" y="673" text-anchor="middle" class="node-text" fill="#166534">Phase done</text>

    <!-- ═══ Green loopback: Phase done → right margin → up → left into Find unblocked
         Routes at x=905, 22px inside outer container right edge (927)   -->
    <line x1="790" y1="669" x2="905" y2="669" stroke="#22c55e" stroke-width="1.5"/>
    <line x1="905" y1="669" x2="905" y2="83" stroke="#22c55e" stroke-width="1.5"/>
    <line x1="905" y1="83" x2="602" y2="83" stroke="#22c55e" stroke-width="1.5" marker-end="url(#arrow-pass)"/>
    <text x="913" y="376" class="label label-pass" transform="rotate(-90 913 376)">Next phase</text>

    <!-- ═══ Red loopback: FAIL → left margin → up → into Builder first node
         Routes at x=365, 23px inside outer container left edge (342)    -->
    <line x1="473" y1="669" x2="365" y2="669" stroke="#ef4444" stroke-width="1.5"/>
    <text x="418" y="662" class="label label-fail">FAIL</text>

    <line x1="365" y1="669" x2="365" y2="327" stroke="#ef4444" stroke-width="1.5"/>
    <line x1="365" y1="327" x2="410" y2="327" stroke="#ef4444" stroke-width="1.5" marker-end="url(#arrow-fail)"/>
    <text x="355" y="498" class="label label-fail" transform="rotate(-90 355 498)">Fresh builder</text>
  </g>

</svg>
